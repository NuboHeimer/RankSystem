Ранговая система для streamer.bot. Работает как для нативных площадок, представленных в боте (twitch, youtube, trovo), так и для площадок поддерживаемых миничатом. Для подключения миничата к стримерботу воспользуйтесь [интеграцией](https://docs.play-code.ru/minichat). Последнюю, на данный момент, версию интеграции можно найти в [streamfony](https://t.me/StreamfonyBot?start=_tgr_JpK_P4xlZmI6), раздел "плагины".

Видеогайд будет сделан в будущем.

⚠ Получение списка зрителей на вк видео лайв стало невозожным с 18.02.2025. Спасибо разработчикам, которые решили, что список зрителей не нужен и сделали вместо него список "активных" чаттеров. ⚠

## Реализованный функционал.
На данный момент система умеет:
- начислять внутреннюю валюту (далее -- коины) по любому триггеру бота, в котором приходит *userName*, *userId* (*minichat.Data.UserID* для миничата), *eventSource*/*commandSource*. На всех площадках.
- запоминать дату фоллова на канал. На всех площадках, для которых есть соответствующий триггер.
- запомниать категорию стрима которая была при фоллове. Только twitch.
- запоминать количество сообщений пользователя. На всех площадках, для которых есть соответствующий триггер.
- запоминать количество времени, которое пользователь смотрел стрим.
    - Twitch.
    - Trovo под вопросом, нужны живые тесты.
    - Youtube не предоставляет список зрителей. Поэтому время запоминается только в том случае, если пользователь писал в чат в определённый период времени. Настройки описаны ниже.
    - VkVideoLive ~~работает при наличии [моей интеграции](https://github.com/NuboHeimer/VkVideoLiveService/releases) для этой площадки.~~ не работает с 18.02.2025
- выводить количество коинов пользователя. На всех площадках.
- выводить игру, на которой зафлловился пользователь. Только twitch.
- выводить время просмотра стрима пользователем. Только twitch, ~~vkvideolive~~, trovo, youtube.
- игнорировать пользователей из чёрного списка.

## Запланированный функционал.
TBD. Пока можете посмотреть проект с одноимённым названием.

## Содержаение файла импорта и настройка.
### Очереди
- **RankSystem** -- блокирующая очередь для корректной работы ранговой системы. Все экшены, взаимодействующие с ранговой системой необходимо создавать в этой очереди.
### Таймеры
- **VKVideoLive** -- нужен для получения времени просмотра на VKVideoLive. **Не работает с 18.02.2025**
### Команды
- **follow** -- пример команды для вывода информации о фолловере. На данный момент выводит игру, на которой зафолловился пользователь.
- **watchtime** -- пример команды для вывода информации о времени просмотра стримов пользователем.
- **Коины** -- пример команды для вывода информации о количестве коинов у пользователя.
### Экшены
- **\[RankSystem] Code** -- экшен с основным кодом.
- **\[RankSystem] Add Coins** -- экшен добавлят пользователю указанное количество коинов. Для корректной работы необходимо наличие аргументов *coinsToAdd*, *userName*, *userId* или *minichat.Data.UserID*, *eventSource* или *commandSource*.
    При вызове через триггер все аргументы кроме *coinsToAdd* берутся из данных триггера.
    В целевом экшене:
    - задайте **Core -> Arguments -> Set Argument**. В **Variable Name** укажите *coinsToAdd*. В **Value** *количесто коинов*.
    - сделайте вызов **Core -> Actions -> Run Action** и выберете описываемый экшен (**\[RankSystem] Add Coins**).
- **\[RankSystem] Get Coins Count** -- экшен выводит количество коинов пользователя по команде **!coins**. На данный момент выводятся коины только для вызвашего команду.
- **\[RankSystem] Get Game When Follow** -- экшен выводит категорию стрима, на которой фолловился пользователь вызвавший команду **!follow**.
- **\[RankSystem] Get Whatch Time** -- экшен выводит время просмотра стримов пользователем вызвавшим команду **!watchtime**.
- **\[RankSystem] SetBlackList** -- в экшене можно задать чёрный список пользователей, на которых не должна реагировать ранговая система. задаётся в формате userName1;userName2;userName3.
    - чёрный список нуждается в переработке и не рекомендован к использованию в текущем виде.
- **\[RankSystem] Update Follow Date** -- экшен запоминания даты фоллова (везде) и категории стрима (только twitch). Так же умеет добавлять коины за фоллов.
    - Настройка:
        - Создать отдельный экшен. В триггерах выбрать триггер фоллова с нужной площадки. В сабэкшенах добавить **Core -> Actions -> Run Action ->** *\[RankSystem] Update Follow Date*.
        - Для добавления коинов за фоллов перед Run Action добавить **Core -> Arguments -> Set Argument**. **Variable Name** -> *coinsToAdd*. **Value** -> *количество коинов за фоллов*.
        - Если для твича нужно запоминать категорию стрима, до перед сабэкшеном из предыдущего пункта надо добавить **Twitch -> User -> Get User Info for Target**. В **Source Type** указать *Broadcaster*.
- **\[RankSystem] Update Message Count** -- экшен запоминания количества сообщений. Так же умеет добавлять коины за сообщение.
    - Настройка:
        - Создать отдельный экшен. В триггерах выбрать триггер сообщения с нужной площадки. В сабэкшенах добавить **Core -> Actions -> Run Action** -> *\[RankSystem] Update Message Count*.
        - Для добавления коинов за сообщение перед Run Action добавить **Core -> Arguments -> Set Argument**. **Variable Name** -> *coinsToAdd*. **Value** -> *количество коинов за сообщение*.
- **\[RankSystem] Update Watchtime** -- экшен обновления времени просмотра стримов пользователем. Предназначен для вызова из других экшенов. Так же умеет добавлять коины за время просмотра.
    - Настройка для Twitch:
        -**Platforms -> Twitch -> Settings -> Present Viewers**. Поставить галочки *Enabled* и *Live Update*. Установить ползунок на значение *1 minute*.
        - Создать отдельный экшен. В триггерах выбрать  **General -> Present Viewers**. В сабэкшенах добавить **Core -> Actions -> Run Action** -> *\[RankSystem] Update Watchtime*.
        - В случае если таймер **Present Viewers** был установлен на значение отличное от *1 minute* необходимо задать время таймера в секундах. Перед **Run Action** добавить **Core -> Arguments -> Set Argument**. **Variable Name** -> *timeToAdd*. **Value** -> *время таймера в секундах*.
        - Для добавления коинов за одно срабатываение таймера перед **Run Action** добавить **Core -> Arguments -> Set Argument**. **Variable Name** -> *coinsToAdd*. **Value** -> *количество коинов за одно срабатывание*.
    - Настройка для VkVideoLive неактуальна в связи с обновлением площадки от 18.02.2025.
    - Настройка для Trovo. Нуждается в тестировании, вероятен сценарий ютубуа, описанный в соотетствующем пункте:
        - **Platforms -> Trovo -> Settings -> Present Viewers**. Поставить галочку *Enabled*. Установить ползунок на значение *1 minute*.
        - Создать отдельный экшен. В триггерах выбрать **Trovo -> General -> Present Viewers**. В сабэкшенах добавить **Core -> Actions -> Run Action** -> *\[RankSystem] Update Watchtime*.
        - В случае если таймер **Present Viewers** был установлен на значение отличное от *1 minute* необходимо задать время таймера в секундах. Перед **Run Action** добавить **Core -> Arguments -> Set Argument**. **Variable Name** -> *timeToAdd*. **Value** -> *время таймера в секундах*.
        - Для добавления коинов за одно срабатываение таймера перед **Run Action** добавить **Core -> Arguments -> Set Argument. Variable Name** -> *coinsToAdd*. **Value** -> *количество коинов за одно срабатывание*.
    - Настройка для Youtube. У ютуба нет понятия "сисок зрителей". Есть понятие "список активных чаттеров". Если пользователь был активен за последние n минут -- он есть в списке. Соответственно, пользователю надо писать в чат каждые n минут, чтобы ему корректо засчитывалось время просмотра:
        - **Platforms -> YouTube -> Settings -> Present Viewers**. Поставить галочку *Enabled*. Установить ползунок на значение *10 minute*. Таймер всё равно будет срабатывать раз минуту, но пользователь будет находиться в списке, если он писал в чат за последние 10 минут.
        - Создать отдельный экшен. В триггерах выбрать **YouTube -> General -> Present Viewers**. В сабэкшенах добавить **Core -> Actions -> Run Action** -> *\[RankSystem] Update Watchtime*.
        - Для добавления коинов за минуту просмотра перед **Run Action** добавить **Core -> Arguments -> Set Argument**. **Variable Name** -> *coinsToAdd*. **Value** -> *количество коинов за одно срабатывание*.
    - Для ютуба и трово отсутствует галочка *Live Update*, при этом в документации она для трово присутствует. Подозреваю, что present viewers для трово работает так же, как и для ютуба.

Остальные экшены будут описаны позже. Следите за обновлениями.
